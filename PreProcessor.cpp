#include "PreProcessor.h"



CPreProcessor::CPreProcessor()
{
	m_nAnalysisResultTime = 0;
}

CPreProcessor::CPreProcessor(int readType, char* strExePath)
{
	m_pStemEndDic = new CStemEndDic(readType, strExePath);
	m_pDocVector = new CNADocVector;
	/*
	m_wndNAHangulAnaly = new CNAHangulAnaly;
	m_wndNAHangulAnaly->m_pStemEndDic = m_pStemEndDic;
	m_wndNAHangulAnaly->m_LinkedList = m_pDocVector;
	*/
	m_wndMorphoLogicalAnalysis = new CMorphoLogicalAnalysis;
	m_wndMorphoLogicalAnalysis->m_pStemEndDic = m_pStemEndDic;
	m_wndMorphoLogicalAnalysis->m_LinkedList = m_pDocVector;

	m_nAnalysisResultTime = 0;
}


CPreProcessor::~CPreProcessor()
{
	/*
	if (m_wndNAHangulAnaly != NULL)
	{
		delete m_wndNAHangulAnaly;
		m_wndNAHangulAnaly = NULL;
	}
	*/
	if (m_wndMorphoLogicalAnalysis != NULL)
	{
		delete m_wndMorphoLogicalAnalysis;
		m_wndMorphoLogicalAnalysis = NULL;
	}
	if (m_pStemEndDic != NULL)
	{
		delete m_pStemEndDic;
		m_pStemEndDic = NULL;
	}
	if (m_pDocVector != NULL)
	{
		delete m_pDocVector;
		m_pDocVector = NULL;
	}
}


void CPreProcessor::RemoveDocVectorData()
{
	m_pDocVector->RemoveAllSentence();
}



void CPreProcessor::InsertLinkedList(char *pstrInsert, int nOffset)
{
	if (m_pDocVector != NULL)
		m_pDocVector->AddTail(pstrInsert, nOffset);
}

void CPreProcessor::InsertLinkedList(H_NODE* pLink)
{
	if (m_pDocVector != NULL)
		m_pDocVector->AddLinkTail(pLink);
}

bool CPreProcessor::InitHangulAnalyClass()
{
	bool bCreate = false;
	if (m_wndMorphoLogicalAnalysis == NULL)
	{
		m_wndMorphoLogicalAnalysis = new CMorphoLogicalAnalysis;
		bCreate = true;
	}
	else
	{
		bCreate = true;
	}
	/*
	if (m_wndNAHangulAnaly == NULL)
	{
		m_wndNAHangulAnaly = new CNAHangulAnaly;
		bCreate = true;
	}
	else
	{
		bCreate = true;
	}
	*/
	
	return bCreate;
}

/*******************************************************************************************
pAllString ¹®ÀåÀÌ µé¾î¿À¸é Space ´ÜÀ§·Î PreToken
Space°¡ ³ª¿À¸é ±× ´ÙÀ½ Char°¡ ³ª¿Ã¶§±îÁö À§Ä¡ÀÌµ¿
'\r', '\n'ÀÌ ³ª¿À¸é nCase = 1·Î ÇØ¼­ PreToken¿¡ ÀúÀå
À§Ä¡ ÀÌµ¿Àü±îÁö ¹®ÀÚ¿­À» PreToken¿¡ ÀúÀå
*******************************************************************************************/
void CPreProcessor::DivideDocSpace(char *pAllString)
{
	unsigned int nTotalCount = 0;
	unsigned int nCheckEnd = 0;
	int nFirstParent = 0, nLastParent = 0;
	int nCharCount = 0;
	int nSpaceOffset = 0;
	char pSaveText[1024];
	int nSaveText = 0;
	bool bAdd = false;
	int nCase = 0;
	char pLongChar[3];
	int nLong1;
	int nLong2;
	char pLongTmp[1024];
	char pOneChar[3];
	char ptmpOneChar[3];

	int nTT = 0;	/*µû¿ÈÇ¥*/
	int nSmalTT = -1;
	
	CNAPreLinkedList* pPreLinkedList = NULL;

	m_pAllString = pAllString;

	pPreLinkedList = new CNAPreLinkedList;
	pPreLinkedList->InitHeadTailNode();

	//Documnet Vector Init
	RemoveDocVectorData();
	

	nTotalCount = strlen(pAllString);
	memset(pSaveText, 0x00, 1024);

	//ºÐ¼® ½ÃÀÛ½Ã°£ ¼³Á¤
	clock_t clockStartTimer, clockEndTimer;
	clockStartTimer = clock();

	while (nTotalCount > (unsigned)nCharCount)
	{
		if (pAllString[nCharCount] == ' ' || pAllString[nCharCount] == '\t')
		{
			if (NextCharPos(pAllString, nCharCount))
				nCase = PRENODE_CHAR_2;//'\r','\n'
			else
				nCase = PRENODE_CHAR_1;//' '

			if (strlen(pSaveText) > 0)
				bAdd = true;
		}
		else if (pAllString[nCharCount] == '\r' || pAllString[nCharCount] == '\n')
		{
			if (pAllString[nCharCount] == '\r' && pAllString[nCharCount + 1] == '\n') 
			{
				nCharCount++;
			}
			nCharCount++;
			if (NextCharPos(pAllString, nCharCount) == true)
				nCase = PRENODE_CHAR_6;//('\r', '\n' )*2
			else
				nCase = PRENODE_CHAR_2;//'\r','\n'
			if (strlen(pSaveText) > 0)
				bAdd = true;
		}
		else if ((pAllString[nCharCount] == '!' || pAllString[nCharCount] == '?' || pAllString[nCharCount] == '.') 
					&& (pAllString[nCharCount + 1] == 0x00 || pAllString[nCharCount + 1] == '\r' || pAllString[nCharCount + 1] == '\n'))
		{
			pSaveText[nSaveText++] = pAllString[nCharCount++];
			NextCharPos(pAllString, nCharCount);
			nCase = PRENODE_CHAR_5;//('?', '!', '.') + ('\r', '\n')
			if (strlen(pSaveText) > 0)
				bAdd = true;
		}
		else if ((pAllString[nCharCount] == '!' || pAllString[nCharCount] == '?' || pAllString[nCharCount] == '.') 
				&& pAllString[nCharCount + 1] == ' ')
		{
			if (pAllString[nCharCount] == '.')
				pSaveText[nSaveText++] = pAllString[nCharCount++];
			else
				nCharCount++;
			if (NextCharPos(pAllString, nCharCount) == true)
				nCase = PRENODE_CHAR_5;//('?', '!', '.') + ('\r', '\n')
			else
				nCase = PRENODE_CHAR_3;//'?', '!', '.'
			if (strlen(pSaveText) > 0)
				bAdd = true;
		}
		else if (pAllString[nCharCount] == '.')
		{
			memset(pOneChar, 0x00, 3);
			if (strlen(pSaveText) >= 2)
			{
				pOneChar[0] = pAllString[nCharCount - 2];
				if (pOneChar[0] & 0x80) // 2 Byte Char?
				{
					pOneChar[1] = pAllString[nCharCount - 1];
				}
			}

			// ÇÑ±Û + '.' + ÇÑ±Û ÀÎÁö ÆÇ´Ü
			if (
				strlen(pSaveText) == 2 
				&& strcmp(pSaveText, "°Í") == 0 
				&& IsDot(pAllString, nCharCount, 3) == true
			)
			{
				nCharCount++;
				nCase = PRENODE_CHAR_3;//'?', '!', '.'
				if (strlen(pSaveText) > 0)
					bAdd = true;
			}
			else if (strlen(pOneChar) == 2 
					&& IsDot(pAllString, nCharCount, 3) == true 
					&&
					(
						strstr("°¨,°·,°×,±¯,±À,±Ñ,±ô,±þ,²Ä,²Õ,²Þ,²ë,²ñ,²û,³¦", pOneChar) != 0 ||
						strstr("³²,³¿,³Ñ,³Û,³ý,´®,´¸,ˆ…,´Ô,´Ù,´ï,µ©,µÊ,µÒ,Š­", pOneChar) != 0 ||
						strstr("µõ,¶¡,¶«,¶¶,¶À,Œ·,¶Ü,¶ä,¶ê,¶ï,·¥,·³,·½,·Ý,·ë", pOneChar) != 0 ||
						strstr("¸§,¸²,¸É,¸Ø,¸â,¸ö,¹Ò,¹ì,º¨,º½,ºÊ,ºö,»­,»Ý,»ã", pOneChar) != 0 ||
						strstr("»ù,¼¶,¼À,¼ë,¼û,½°,½É,½Ó,½Ü,½æ,½ô,¾¢,¾©,¾¸,¾½", pOneChar) != 0 ||
						strstr("¾Ú,¾ä,¿°,¿È,¿à,¿ò,À«,À½,ÀÊ,ÀÓ,Àá,ÁÎ,ÁÜ,Áç,Áü", pOneChar) != 0 ||
						strstr("Â«,Â´,ÂÍ,ÂÛ,Ââ,Âò,Âü,Ã¨,Ãã,Ãî,Ä§,ÄÔ,Äñ,Å¡,Å­", pOneChar) != 0 ||
						strstr("Å´,Å½,ÅÆ,Åù,Æ¦,Æ´,Æº,ÆÀ,ÆÊ,ÆÔ,Æï,½I,Ç°,ÇÄ,ÇË", pOneChar) != 0 ||
						strstr("ÇÔ,Çð,ÈÚ,Èô,Èû,´Ù", pOneChar) != 0
					))
			{
				nCharCount++;
				nCase = PRENODE_CHAR_3;//'?', '!', '.'
				if (strlen(pSaveText) > 0)
					bAdd = true;
			}
			else if ((int)strlen(pSaveText) > 2 
					&& strcmp("´Ù", pOneChar) == 0 
					&&(pAllString[nCharCount + 1] >= 'A' && pAllString[nCharCount + 1] <= 'Z' || pAllString[nCharCount + 1] >= 'a' && pAllString[nCharCount + 1] <= 'z'))
			{
				nCharCount++;
				nCase = PRENODE_CHAR_3;//'?', '!', '.'
				if (strlen(pSaveText) > 0)
					bAdd = true;
			}
			else
			{
				pSaveText[nSaveText++] = pAllString[nCharCount++];
			}
		}
		else if (pAllString[nCharCount] == ',')
		{
			if (IsCurrency(pAllString, nCharCount, FALSE_ASCII))
			{
				nCharCount++;
			}
			else
			{
				// ','Àü¿¡ ¹®ÀÚ°¡ ÀÖÀ¸¸é ¸ÕÀú Ãß°¡
				if (strlen(pSaveText) > 0)
				{
					pPreLinkedList->AddPreTail(pSaveText, nSpaceOffset, PRENODE_CHAR_1, nFirstParent, nLastParent);//' '
					//Comma ÀÚÁú ¼ÂÆÃ
					pPreLinkedList->m_pTailNode->pPrev->pPreToken->pFeature[SYMBOL_COMMA] = '1';//215

					memset(pSaveText, 0x00, 1024);
					nCase = 0;
					nSaveText = 0;
					nFirstParent = 0;
					nLastParent = 0;
				}
				else
				{
					nCharCount++;
				}
			}
		}
		else if (pAllString[nCharCount] == '-')//»ê¼ú ¿¬»êÀÚ
		{
			if (!IsOperation(pAllString, nCharCount, TRUE_ASCII))
			{
				nCase = PRENODE_CHAR_1;//' '
				if (strlen(pSaveText) > 0)
					bAdd = true;
				nCharCount++;
			}
			else
				pSaveText[nSaveText++] = pAllString[nCharCount++];
		}
		else
		{
			// First Char Position
			if (nSaveText == 0)
				nSpaceOffset = nCharCount;

			memset(pOneChar, 0x00, 3);
			pOneChar[0] = pAllString[nCharCount];
			if (pOneChar[0] & 0x80) // 2 Byte Char?
			{
				pOneChar[1] = pAllString[nCharCount + 1];
				if (strcmp(pOneChar, "¡°") == 0 || strcmp(pOneChar, "¡±") == 0)
				{
					pSaveText[nSaveText++] = '"';
					nTT = 1;
				}
				else if (strcmp(pOneChar, "¡®") == 0 || strcmp(pOneChar, "¡¯") == 0)
				{
				}
				else if (strcmp(pOneChar, "¡­") == 0)
					pSaveText[nSaveText++] = '~';
				else if (strcmp(pOneChar, "£¤") == 0)
					pSaveText[nSaveText++] = '$';
				else if (strcmp(pOneChar, "£Ü") == 0)
					pSaveText[nSaveText++] = '\\';
				else if (
							strcmp(pOneChar, "¡¤") == 0 
							&& IsSlachDot(pAllString, nCharCount, FALSE_ASCII) != 1
				)
				{
					nCase = PRENODE_CHAR_1;//' '
					if (strlen(pSaveText) > 0)
						bAdd = true;
				}
				else
				{
					pSaveText[nSaveText++] = pOneChar[0];
					pSaveText[nSaveText++] = pOneChar[1];
				}
				nCharCount += 2;
			}
			else
			{
				if (pAllString[nCharCount] == '"')
					nTT = 1;
				if (pAllString[nCharCount] == '`')
					pAllString[nCharCount] = '\'';

				if (nFirstParent == 0)	//¿©´Â °ýÈ£
					nFirstParent = GetParentSymbol(pAllString[nCharCount]);
				if (nLastParent == 0)  //´Ý´Â °ýÈ£
					nLastParent = GetParentSymbol(pAllString[nCharCount], 1);

				if (nFirstParent == SYMBOL_CHAR_2 && nTT == 1)//'('
				{
					nFirstParent = 0;
					nCase = PRENODE_CHAR_1;//' '
					if (strlen(pSaveText) > 0)
						bAdd = true;
				}
				else if (nFirstParent == SYMBOL_CHAR_2 && nLastParent == 0)//'('
				{
					pAllString[nCharCount] = ' ';
					nCharCount++;
					nCase = PRENODE_CHAR_1;//' '
					if (strlen(pSaveText) > 0)
						bAdd = true;
				}
				else
				{
					if (nLastParent != SYMBOL_CHAR_6)//')'
						pSaveText[nSaveText++] = pAllString[nCharCount];
					nCharCount++;

					//¾î´Â,´Ý´Â°ýÈ£°¡ µ¿½Ã¿¡ ³ª¿Ã°æ¿ì ÇÑ´Ü¾î·Î Ã³¸® ¿¹) (ÇÑ±¹)
					if (nFirstParent == nLastParent - 4)
					{
						ptmpOneChar[0] = pAllString[nCharCount];
						ptmpOneChar[1] = pAllString[nCharCount + 1];
						ptmpOneChar[2] = 0;
						if (pAllString[nCharCount + 2] == 0 
							&&(strcmp(ptmpOneChar, "ÀÌ") == 0 || strcmp(ptmpOneChar, "°¡") == 0 
								|| strcmp(ptmpOneChar, "Àº") == 0 || strcmp(ptmpOneChar, "´Â") == 0 
								|| strcmp(ptmpOneChar, "À»") == 0 || strcmp(ptmpOneChar, "¸¦") == 0))
						{
							nCharCount++;
						}
						else
						{
							nCase = PRENODE_CHAR_1;//' '
							if (strlen(pSaveText) > 0)
								bAdd = true;
						}
					}
				}
			}
		}

		if (nTotalCount < (unsigned)nCharCount + 1 || bAdd == true)
		{
			if (pSaveText && strcmp(pSaveText, ".") != 0 && strcmp(pSaveText, "~") != 0)
			{
				pPreLinkedList->AddPreTail(pSaveText, nSpaceOffset, nCase, nFirstParent, nLastParent);
				// [Comman] ÀÚÁú Setting
				if (nCase == PRENODE_CHAR_4)//','
					(pPreLinkedList->GoPreNodeLast())->pPreToken->pFeature[SYMBOL_COMMA] = '1';//215
			}
			nTT = 0;
			nCase = 0;
			nSaveText = 0;
			bAdd = false;
			nFirstParent = 0;
			nLastParent = 0;
			memset(pSaveText, 0x00, 1024);
		}
		// ±ä¾îÀý Ã³¸®
		else if (nSaveText >= LONG_TOKEN - 1)//40
		{
			for (nLong1 = 0; nLong1<nSaveText; nLong1++)
			{
				memset(pLongChar, 0x00, 3);
				pLongChar[0] = pSaveText[nLong1];
				pLongChar[1] = pSaveText[nLong1 + 1];
				if (strstr("°¡,°Ô,°í,°ú,±î,³ª,³Ä,³×,³ç,´¢,´Â,´Ï,´Ù,´ë,´ø,µ¥", pLongChar) != NULL 
					||strstr("µµ,µç,·¡,·Á,·Ä,·Å,·Î,·Ï,¸¦,¸®,¸¸,¸ç,¸é,¹×,¼­,¼î,½´", pLongChar) != NULL 
					||strstr("½¼,¾Æ,¾ß,¿¡,¿À,¿Í,¿ä,¿î,À»,ÀÇ,ÀÌ,ÀÚ,ÁÒ,Áï,Áö,Â÷,Å×", pLongChar) != NULL)
				{
					memset(pLongTmp, 0x00, 1024);
					nFirstParent = 0;
					nLastParent = 0;
					for (nLong2 = 0; nLong2<nLong1 + 2; nLong2++)
					{
						if (nFirstParent == 0)	//¿©´Â °ýÈ£
							nFirstParent = GetParentSymbol(pAllString[nCharCount]);
						if (nLastParent == 0)  //´Ý´Â °ýÈ£
							nLastParent = GetParentSymbol(pAllString[nCharCount], 1);
						pLongTmp[nLong2] = pSaveText[nLong2];
					}
					pPreLinkedList->AddPreTail(pLongTmp, nSpaceOffset, 1, nFirstParent, nLastParent);
					nSpaceOffset = nSpaceOffset + nLong2;
					nCharCount = nSpaceOffset;

					nTT = 0;
					nCase = 0;
					nSaveText = 0;
					bAdd = false;
					nFirstParent = 0;
					nLastParent = 0;
					memset(pSaveText, 0x00, 1024);
				}
			}
		}
		else
		{
			//2017-08-16 ¹®ÀåºÐ¸®°¡ Á¤»óÀûÀ¸·Î ÀÌ·ç¾î ÁöÁö ¾ÊÀ» °æ¿ì¿¡ °ªÀ» Áõ°¡ÇÏ°Ô ¸¸µé¾î ¹«ÇÑ·çÇÁ¹æÁöÇÏ°Ô Ãß°¡ÇÔ.
			//¹®Àå¿¹ : if (size != -1) printf ("Size = %ld\n", size); else printf("File Not Found\n");
			//nCharCount++;
		}
	}

	// Space ´ÜÀ§·Î ¾îÀýÀ» ¸¸µç ´ÙÀ½ ¹®Àå ¹× H_NODE ±¸¼º
	PreLinkedNode(pPreLinkedList);
	


	// Pre Node »èÁ¦
	if (pPreLinkedList != NULL)
	{
		pPreLinkedList->RemovePreAll();
		delete pPreLinkedList;
		pPreLinkedList = NULL;
	}

	
	//ºÐ¼®Á¾·á½Ã°£¼³Á¤
	clockEndTimer = clock();
	m_nAnalysisResultTime = (double)(clockEndTimer - clockStartTimer) / CLOCKS_PER_SEC;
}



//-------------------------------------------------------------------------------
// m_pNode : ÇöÀç PreNode À§Ä¡
// pSetenceHeadNode : ¹®ÀåÀÇ Ã¹ À§Ä¡
// pSetenceTailNode : ¹®ÀåÀÇ ¸¶Áö¸· À§Ä¡
// m_pNode°¡ Áö³ª°¡¸é¼­ pSetenceHeadNode¸¦ ¼³Á¤ÇÏ°í pSetenceTailNode¿¡ ¼³Á¤µÇ¸é
// pSetenceHeadNode¿¡¼­ pSetenceTailNode±îÁö '¹®Àå'À» Ãß°¡ÇÏ°í H_NODE¸¦ Ãß°¡
//-------------------------------------------------------------------------------
void CPreProcessor::PreLinkedNode(CNAPreLinkedList* pPreLinkedList)
{
	char* pstrText = NULL;
	char* pUnitStr = NULL;
	int nLen = 0;
	int nOffset = 0;
	int nParent = 0;
	int nPos = -1; // Æ¯¼öºÎÈ£ À§Ä¡
	bool bHanja = true;

	int nLeftSymbol = -1;
	int nRightSymbol = -1;
	char pOneChar[3];
	int nOneLen = 0;

	PRE_NODE* m_pNode = NULL;
	PRE_NODE* pTmpNode = NULL;
	PRE_NODE* pCommaTmpNode = NULL;
	PRE_NODE* pParentNode = NULL;		//°ýÈ£ Ã¹¹øÂ° À§Ä¡ '('
	PRE_NODE* pSentenceFirst = NULL;
	PRE_NODE* pSentenceLast = NULL;

	m_pNode = pPreLinkedList->m_pHeadNode->pNext;
	pSentenceFirst = m_pNode;

	while (m_pNode != pPreLinkedList->m_pTailNode)
	{
		// '\n'ÀÌ ¿¬¼ÓµÇ¾î ³ª¿À´Â °æ¿ì ¹®Àå ºÐÇÒ
		if (m_pNode->pPreToken->nEndCheck == PRENODE_CHAR_6)//('\r', '\n' )*2
		{
			pSentenceLast = m_pNode;
			SentenceAddNode(pSentenceFirst, pSentenceLast);	//¹®ÀåºÐÇÒ
			pSentenceFirst = m_pNode->pNext;//¹®Àå Ã¹¹øÂ° Link
			pSentenceLast = NULL;
		}
		// '.' Ã³¸®
		else if (m_pNode->pPreToken->nEndCheck == PRENODE_CHAR_3)//'?', '!', '.'
		{
			memset(pOneChar, 0x00, 3);
			pOneChar[0] = m_pNode->pPreToken->strOriginalSource[0];
			pOneChar[1] = m_pNode->pPreToken->strOriginalSource[1];

			// ¸¶Ä§Ç¥ : ÅäÅ«ÀÌ µÎ¹®ÀÚ·Î ±¸¼ºµÇ¾î ÀÖ°í, ¹®ÀÚ°¡ Á¡(°¡. ³ª. a.) ¾Æ´Ñ°æ¿ì)
			if (!(m_pNode->pPreToken->strOriginalSource[2] == '.' &&
				strstr("¤¡,¤¤,¤§,¤©,¤±,¤²,¤µ,¤·,¤¸,¤»,¤¼,¤½,¤¾,°¡,³ª,´Ù,¶ó,¸¶,¹Ù,»ç,¾Æ,ÀÚ,Ä«,Å¸,ÆÄ,ÇÏ", pOneChar) != 0) &&
				!(m_pNode->pPreToken->strOriginalSource[1] == '.' &&
				((m_pNode->pPreToken->strOriginalSource[0] >= 'a' && m_pNode->pPreToken->strOriginalSource[0] <= 'z') ||
					(m_pNode->pPreToken->strOriginalSource[0] >= 'A' && m_pNode->pPreToken->strOriginalSource[0] <= 'Z') ||
					(m_pNode->pPreToken->strOriginalSource[0] >= '0' && m_pNode->pPreToken->strOriginalSource[0] <= '9'))))
			{
				pSentenceLast = m_pNode;
				NodeOneCharRemove(m_pNode, ".");
				SentenceAddNode(pSentenceFirst, pSentenceLast);	//¹®ÀåºÐÇÒ
				pSentenceFirst = m_pNode->pNext;//¹®Àå Ã¹¹øÂ° Link
				pSentenceLast = NULL;
			}
		}
		// '.', '?', '!'
		else if (m_pNode->pPreToken->nEndCheck == PRENODE_CHAR_5)//('?', '!', '.') + ('\r', '\n')
		{
			memset(pOneChar, 0x00, 3);
			pOneChar[0] = m_pNode->pPreToken->strOriginalSource[0];
			pOneChar[1] = m_pNode->pPreToken->strOriginalSource[1];

			// ¸¶Ä§Ç¥ : ÅäÅ«ÀÌ µÎ¹®ÀÚ·Î ±¸¼ºµÇ¾î ÀÖ°í, ¹®ÀÚ°¡ Á¡(°¡. ³ª. a.) ¾Æ´Ñ°æ¿ì)
			if (!(m_pNode->pPreToken->strOriginalSource[2] == '.' &&
				strstr("¤¡,¤¤,¤§,¤©,¤±,¤²,¤µ,¤·,¤¸,¤»,¤¼,¤½,¤¾,°¡,³ª,´Ù,¶ó,¸¶,¹Ù,»ç,¾Æ,ÀÚ,Ä«,Å¸,ÆÄ,ÇÏ", pOneChar) != 0) &&
				!(m_pNode->pPreToken->strOriginalSource[1] == '.' &&
				((m_pNode->pPreToken->strOriginalSource[0] >= 'a' && m_pNode->pPreToken->strOriginalSource[0] <= 'z') ||
					(m_pNode->pPreToken->strOriginalSource[0] >= 'A' && m_pNode->pPreToken->strOriginalSource[0] <= 'Z') ||
					(m_pNode->pPreToken->strOriginalSource[0] >= '0' && m_pNode->pPreToken->strOriginalSource[0] <= '9'))))
			{
				pSentenceLast = m_pNode;
				NodeOneCharRemove(m_pNode, ".");
				NodeOneCharRemove(m_pNode, "!");
				NodeOneCharRemove(m_pNode, "?");
				NodeOneCharRemove(m_pNode, "\"");
				SentenceAddNode(pSentenceFirst, pSentenceLast);	//¹®ÀåºÐÇÒ
				pSentenceFirst = m_pNode->pNext;//¹®Àå Ã¹¹øÂ° Link
				pSentenceLast = NULL;
			}
		}
		else if (m_pNode->pPreToken->nEndCheck == PRENODE_CHAR_2 && m_pNode->pNext != pPreLinkedList->m_pTailNode)//'\r','\n'
		{
			pSentenceLast = m_pNode;
			SentenceAddNode(pSentenceFirst, pSentenceLast);	//¹®ÀåºÐÇÒ
			pSentenceFirst = m_pNode->pNext;//¹®Àå Ã¹¹øÂ° Link
			pSentenceLast = NULL;
		}
		// 4. µû¿ÈÇ¥¿Í °ýÈ£ Ã³¸®
		else
		{
			if ((m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_1 && m_pNode->pPreToken->nLastParent == SYMBOL_CHAR_5) //'<' , //'>'
				||(m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_2 && m_pNode->pPreToken->nLastParent == SYMBOL_CHAR_6) //'(' ,//')'
				||(m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_3 && m_pNode->pPreToken->nLastParent == SYMBOL_CHAR_7) //'[' ,//']'
				||(m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_4 &&m_pNode->pPreToken->nLastParent == SYMBOL_CHAR_8))//'{',//'}'
			{
				bHanja = false;
			}
			else if (bHanja == true)
			{
				//°ýÈ£¿¡ ÀÖ´Â ÇÑÀÚ´Â ¹ÌÃ³¸®
				Hanja2Hangul(m_pNode);
			}
			else
				bHanja = true;

			ParentNodeTotal(pPreLinkedList, m_pNode);
		}


		switch (CharFindSymbol(m_pNode, &nPos))
		{
		case 1:		// '.'
			if (IsDot(m_pNode->pPreToken->strOriginalSource, nPos, TRUE_ASCII) == false)
			{
				NodeOneCharRemove(m_pNode, ".");
				CharSymbolDelete(m_pNode);
				CharSymbolDelete(m_pNode);
			}
			break;
		case 2:   // ?, !
			NodeOneCharRemove(m_pNode, "?");
			NodeOneCharRemove(m_pNode, "!");
			CharSymbolDelete(m_pNode);
			break;
		case 3:   // / ½½·¡½¬
				  // ÇÑ±ÛÀÏ¶§
			if (IsSlachDot(m_pNode->pPreToken->strOriginalSource, nPos, TRUE_ASCII) != 1)
			{
				pPreLinkedList->PreNodeDivide(m_pNode, nPos, 1);

				// [ns], [ne] ÀÚÀß Setting
				if (m_pNode->pPreToken->pFeature[SYMBOL_NE] == '1')//214
					m_pNode->pPreToken->pFeature[SYMBOL_NE] = '0';
				else
					m_pNode->pPreToken->pFeature[SYMBOL_NS] = '1';
				if (m_pNode->pNext != NULL && m_pNode->pNext->pPreToken != NULL)
					m_pNode->pNext->pPreToken->pFeature[SYMBOL_NE] = '1';
			}
			break;
		case 4:   // ¡¤(2) °¡¿îµ¥Á¡
				  // ÇÑ±ÛÀÏ¶§
			if (IsSlachDot(m_pNode->pPreToken->strOriginalSource, nPos, FALSE_ASCII) != 1)
			{
				pPreLinkedList->PreNodeDivide(m_pNode, nPos, 2);
				// [ns], [ne] ÀÚÁú Setting
				if (m_pNode->pPreToken->pFeature[SYMBOL_NE] == '1')
					m_pNode->pPreToken->pFeature[SYMBOL_NE] = '0';
				else
					m_pNode->pPreToken->pFeature[SYMBOL_NS] = '1';
				if (m_pNode->pNext != NULL && m_pNode->pNext->pPreToken != NULL)
					m_pNode->pNext->pPreToken->pFeature[SYMBOL_NE] = '1';
			}
			break;
		case 5:   // +, -, *, =, :
			if (IsOperation(m_pNode->pPreToken->strOriginalSource, nPos, TRUE_ASCII) == false)
			{
				NodeOneCharRemove(m_pNode, "+");
				NodeOneCharRemove(m_pNode, "-");
				NodeOneCharRemove(m_pNode, "=");
				NodeOneCharRemove(m_pNode, "*");
				NodeOneCharRemove(m_pNode, ":");
				NodeOneCharRemove(m_pNode, "~");
				CharSymbolDelete(m_pNode);
			}
			break;
		case 6:   // ¡É(2) ¼ö½ÄºÎÈ£
			if (IsOperation(m_pNode->pPreToken->strOriginalSource, nPos, FALSE_ASCII) == false)
			{
				NodeTwoCharRemove(m_pNode, "¡É");
				CharSymbolDelete(m_pNode);
			}
			break;
		case 7:   // \, $, %
			if (IsCurrency(m_pNode->pPreToken->strOriginalSource, nPos, TRUE_ASCII) == false)
			{
				NodeOneCharRemove(m_pNode, "$");
				NodeOneCharRemove(m_pNode, "\\");
				NodeOneCharRemove(m_pNode, "%");
				CharSymbolDelete(m_pNode);
			}
			break;
		case 8:   // £Ü, £¤
			if (IsCurrency(m_pNode->pPreToken->strOriginalSource, nPos, FALSE_ASCII) == false)
			{
				NodeTwoCharRemove(m_pNode, "£Ü");
				NodeTwoCharRemove(m_pNode, "£¤");
				CharSymbolDelete(m_pNode);
			}
			break;
		case 9:   // @
			if (IsInternetChar(m_pNode->pPreToken->strOriginalSource, nPos, TRUE_ASCII) == false)
			{
				NodeTwoCharRemove(m_pNode, "@");
				CharSymbolDelete(m_pNode);
			}
			break;
		default:  // ³ª¸ÓÁö Æ¯¼ö ±âÈ£ Áö¿ì±â
			if (m_pNode->pPreToken->strOriginalSource[0] != ',')
			{
				CharSymbolDelete(m_pNode);
			}
		}
		//Next Node
		m_pNode = m_pNode->pNext;
	}

	// ¹®ÀåÀÇ ³¡ÀÌ ¾È³ª¿ÔÀ»¶§ ¹®Àå ºÐÇÒ
	if (pSentenceFirst != pPreLinkedList->m_pTailNode)
	{
		pSentenceLast = m_pNode->pPrev;
		SentenceAddNode(pSentenceFirst, pSentenceLast);	//¹®ÀåºÐÇÒ

	}

}

// PRE_NODEÀÇ First¿Í Last¸¦ ÀÔ·Â¹Þ¾Æ ¹®Àå Ãß°¡
void CPreProcessor::SentenceAddNode(PRE_NODE* pSentenceFirst, PRE_NODE* pSentenceLast)
{
	// 1. ¹®Àå ÀÚ·á±¸Á¶ »ý¼º AddSentenceTail(char* pSentence, int nOffset)
	// 2. ¹®Àå ³» ±âÈ£Ã³¸®
	// 3. ¹®ÀåÀÇ ÇüÅÂ¼Ò ÀÚ·á±¸Á¶ Ãß°¡
	// 4. ¹®ÀåÀÇ String ¸¸µé±â(4096)
	// 5. ¹®ÀåÀÇ StringÀÇ Replace
	// 6. ÇüÅÂ¼Ò ºÐ¼®
	int nLen = strlen(m_pAllString);
	char* pSentence = (char*)malloc(strlen(m_pAllString) + 1);
	memset(pSentence, 0x00, strlen(m_pAllString) + 1);
	
	bool bFirst = false;
	PRE_NODE* pTempNode = pSentenceFirst;
	int nPos = 0;
	int i, n = 0;

	nPos = pSentenceLast->pPreToken->nOffset + strlen(pSentenceLast->pPreToken->strOriginalSource) + 1;


	for (i = pSentenceFirst->pPreToken->nOffset; i<nPos; i++)
	{
		pSentence[n++] = m_pAllString[i];
	}
	
	if (nLen > i)
	{
		while (m_pAllString[i] != ' '
			&& m_pAllString[i] != '\r'
			&& m_pAllString[i] != '\n'
			&& m_pAllString[i] != '\0')
		{
			pSentence[n++] = m_pAllString[i++];
		}
	}
	// Insert Setence
	m_pDocVector->AddSentenceTail(pSentence, pSentenceFirst->pPreToken->nOffset);

	while (pTempNode->pPreToken && pTempNode != pSentenceLast)
	{
		if (strlen(pTempNode->pPreToken->strOriginalSource) > 0)
		{
			m_pDocVector->AddTail(pTempNode->pPreToken->strOriginalSource, pTempNode->pPreToken->pFeature, pTempNode->pPreToken->nOffset);
		}
		pTempNode = pTempNode->pNext;
	}

	if (pTempNode->pPreToken && strlen(pTempNode->pPreToken->strOriginalSource) > 0)
	{
		m_pDocVector->AddTail(pTempNode->pPreToken->strOriginalSource, pTempNode->pPreToken->pFeature, pTempNode->pPreToken->nOffset);
	}

	// Sentence Replace
	if (strlen(pSentence) > 0)
	{
		// ÇüÅÂ¼Ò ºÐ¼®
		//m_wndNAHangulAnaly->StartHangulAnaly();
		m_wndMorphoLogicalAnalysis->StartMorphoLogicalAnalysis();
	}
	else
	{
		m_pDocVector->RemoveTailSentence();
	}



	//******************************************************************************
	//2017-06-21 malloc ¸Þ¸ð¸® ÇØÁ¦ÇÑ´Ù. 
	//******************************************************************************
	if(pSentence != NULL){
		free(pSentence);
		pSentence = NULL;
	}
}



int CPreProcessor::GetParentSymbol(char pChar, int nCase)
{
	int nReturn = 0;

	//°ýÈ£ ¿­±â
	if (nCase == 0)
	{
		if (pChar == '<')
			nReturn = SYMBOL_CHAR_1;
		else if (pChar == '(')
			nReturn = SYMBOL_CHAR_2;
		else if (pChar == '[')
			nReturn = SYMBOL_CHAR_3;
		else if (pChar == '{')
			nReturn = SYMBOL_CHAR_4;
	}
	//°ýÈ£ ´Ý±â
	else
	{
		if (pChar == '>')
			nReturn = SYMBOL_CHAR_5;
		else if (pChar == ')')
			nReturn = SYMBOL_CHAR_6;
		else if (pChar == ']')
			nReturn = SYMBOL_CHAR_7;
		else if (pChar == '}')
			nReturn = SYMBOL_CHAR_8;
	}

	return nReturn;
}

// ÇÁ·Î¼¼½º04 : ¹®ÀåºÎÇÒ(Æ¯¼ö±âÈ£ Return)
int CPreProcessor::CharFindSymbol(PRE_NODE* m_pNode, int* nPos)
{
	int nReturn = -1;
	int n, nLen = 0;
	char pOneChar[3];

	if (m_pNode != NULL && m_pNode->pPreToken != NULL && m_pNode->pPreToken->strOriginalSource != NULL)
	{
		nLen = strlen(m_pNode->pPreToken->strOriginalSource);

		for (n = 0; n<nLen; n++)
		{
			pOneChar[0] = m_pNode->pPreToken->strOriginalSource[n];
			pOneChar[1] = m_pNode->pPreToken->strOriginalSource[n + 1];
			pOneChar[2] = 0;
			if (pOneChar[0] == '.')
				nReturn = 1;
			else if (pOneChar[0] == '?' || pOneChar[0] == '!')
				nReturn = 2;
			else if (pOneChar[0] == '/')
				nReturn = 3;
			else if (strcmp(pOneChar, "¡¤") == 0)
				nReturn = 4;
			else if (pOneChar[0] == '+' || pOneChar[0] == '-' ||
				pOneChar[0] == '*' || pOneChar[0] == '=' ||
				pOneChar[0] == ':' || pOneChar[0] == '~')
				nReturn = 5;
			else if (strcmp(pOneChar, "¡É") == 0)
				nReturn = 6;
			else if (pOneChar[0] == '$' || pOneChar[0] == '\\' || pOneChar[0] == '%')
				nReturn = 7;
			else if (strcmp(pOneChar, "£Ü") == 0 || strcmp(pOneChar, "£¤") == 0)
				nReturn = 8;
			else if (pOneChar[0] == '@')
				nReturn = 9;

			if (nReturn != -1)
			{
				*nPos = n;
				break;
			}
		}
	}
	return nReturn;
}

// Æ¯¼ö±âÈ£ Ã£±â
// pSearch¸¦ m_pNode->pPreToken->strOriginalSource¿¡¼­ Ã£À½
int CPreProcessor::CharFindSymbol(PRE_NODE* m_pNode, char* pSearch)
{
	int nReturn = -1;
	int n, nLen = 0, nLen2 = 0;
	char pOneChar[3];
	int nCount = 0;

	if (m_pNode != NULL && m_pNode->pPreToken != NULL &&
		m_pNode->pPreToken->strOriginalSource != NULL && pSearch != NULL)
	{
		nLen = strlen(m_pNode->pPreToken->strOriginalSource);
		nLen2 = strlen(pSearch);
		if (nLen2 == 2)
		{
			for (n = 0; n<nLen; n++)
			{
				pOneChar[0] = m_pNode->pPreToken->strOriginalSource[n];
				pOneChar[1] = m_pNode->pPreToken->strOriginalSource[n + 1];
				pOneChar[2] = 0;
				if (strcmp(pOneChar, pSearch) == 0)
					nCount += 1;
			}
		}
		else if (nLen2 == 1)
		{
			for (n = 0; n<nLen; n++)
			{
				pOneChar[0] = m_pNode->pPreToken->strOriginalSource[n];
				pOneChar[1] = 0;
				if (pOneChar[0] == pSearch[0])
					nCount += 1;
			}
		}
	}
	if (nCount != 0)
		nReturn = nCount;
	return nReturn;
}

// Æ¯¼ö±âÈ£ »èÁ¦(¹Ì»èÁ¦)
int CPreProcessor::CharSymbolDelete(PRE_NODE* m_pNode)
{
	int nReturn = -1;
	int n, nLen = 0;
	char pOneChar[3];
	char* pOri = NULL;
	int nTmp = 0;
	char pTemp[1204];
	int nChar = -1;

	memset(pTemp, 0x00, 1024);

	if (m_pNode != NULL && m_pNode->pPreToken != NULL && m_pNode->pPreToken->strOriginalSource != NULL)
	{
		pOri = m_pNode->pPreToken->strOriginalSource;
		nLen = strlen(pOri);
		for (n = 0; n<nLen;)
		{
			memset(pOneChar, 0x00, 3);
			pOneChar[0] = pOri[n];
			if (pOneChar[0] & 0x80) // 2 Byte Char?
			{
				pOneChar[1] = pOri[n + 1];
				nChar = -1;
				nChar = GetCharCode(pOneChar);
				if (nChar == SPECIAL_CHAR_WORD)
				{
					//¢µ¡Ë¡Ì§¤§É§Ê§Ë§Ì§Í§º§Ü§Ý§Þ§¶§·§¸§Ô§Õ§Ö§×§Ø§¡§¢
					//§£§¥§«§¬§­§®§¯§°§±§²§³§´§§§¨§©§ª§½§¾§å§æ§ç§è§á
					//§â§ã§¿§À§Á§Â§Ã§Ä§Å§Æ§Ç§È§Î§Ï§Ð§Ñ§Ò§Ó§Ú§Û¢ã§ì§¦
					//§à§ï¢á§¼§í§µ§¹§ê§ë§ß¢ä§ä§î§é
					if (strcmp(pOneChar, "¢µ") == 0 || strcmp(pOneChar, "¡Ë") == 0 || strcmp(pOneChar, "¡Ì") == 0 || strcmp(pOneChar, "§¥") == 0 || strcmp(pOneChar, "§«") == 0 || strcmp(pOneChar, "§¬") == 0 ||
						strcmp(pOneChar, "§­") == 0 || strcmp(pOneChar, "§®") == 0 || strcmp(pOneChar, "§¯") == 0 || strcmp(pOneChar, "§°") == 0 || strcmp(pOneChar, "§±") == 0 || strcmp(pOneChar, "§²") == 0 ||
						strcmp(pOneChar, "§³") == 0 || strcmp(pOneChar, "§´") == 0 || strcmp(pOneChar, "§§") == 0 || strcmp(pOneChar, "§¨") == 0 || strcmp(pOneChar, "§©") == 0 || strcmp(pOneChar, "§ª") == 0 ||
						strcmp(pOneChar, "§½") == 0 || strcmp(pOneChar, "§¾") == 0 || strcmp(pOneChar, "§å") == 0 || strcmp(pOneChar, "§æ") == 0 || strcmp(pOneChar, "§ç") == 0 || strcmp(pOneChar, "§è") == 0 ||
						strcmp(pOneChar, "§á") == 0 || strcmp(pOneChar, "§â") == 0 || strcmp(pOneChar, "§ã") == 0 || strcmp(pOneChar, "§¿") == 0 || strcmp(pOneChar, "§À") == 0 || strcmp(pOneChar, "§Á") == 0 ||
						strcmp(pOneChar, "§Â") == 0 || strcmp(pOneChar, "§Ã") == 0 || strcmp(pOneChar, "§Ä") == 0 || strcmp(pOneChar, "§Å") == 0 || strcmp(pOneChar, "§Æ") == 0 || strcmp(pOneChar, "§Ç") == 0 ||
						strcmp(pOneChar, "§È") == 0 || strcmp(pOneChar, "§Î") == 0 || strcmp(pOneChar, "§Ï") == 0 || strcmp(pOneChar, "§Ð") == 0 || strcmp(pOneChar, "§Ñ") == 0 || strcmp(pOneChar, "§Ò") == 0 ||
						strcmp(pOneChar, "§Ó") == 0 || strcmp(pOneChar, "§Ú") == 0 || strcmp(pOneChar, "§Û") == 0 || strcmp(pOneChar, "¢ã") == 0 || strcmp(pOneChar, "§ì") == 0 || strcmp(pOneChar, "§¦") == 0 ||
						strcmp(pOneChar, "§à") == 0 || strcmp(pOneChar, "§ï") == 0 || strcmp(pOneChar, "¢á") == 0 || strcmp(pOneChar, "§¼") == 0 || strcmp(pOneChar, "§í") == 0 || strcmp(pOneChar, "§µ") == 0 ||
						strcmp(pOneChar, "§¹") == 0 || strcmp(pOneChar, "§ê") == 0 || strcmp(pOneChar, "§ë") == 0 || strcmp(pOneChar, "§ß") == 0 || strcmp(pOneChar, "¢ä") == 0 || strcmp(pOneChar, "§ä") == 0 ||
						strcmp(pOneChar, "§î") == 0 || strcmp(pOneChar, "§é") == 0 || strcmp(pOneChar, "§¤") == 0 || strcmp(pOneChar, "§É") == 0 || strcmp(pOneChar, "§Ê") == 0 || strcmp(pOneChar, "§Ë") == 0 ||
						strcmp(pOneChar, "§Ì") == 0 || strcmp(pOneChar, "§Í") == 0 || strcmp(pOneChar, "§º") == 0 || strcmp(pOneChar, "§Ü") == 0 || strcmp(pOneChar, "§Ý") == 0 || strcmp(pOneChar, "§Þ") == 0 ||
						strcmp(pOneChar, "§¶") == 0 || strcmp(pOneChar, "§·") == 0 || strcmp(pOneChar, "§¸") == 0 || strcmp(pOneChar, "§Ô") == 0 || strcmp(pOneChar, "§Õ") == 0 || strcmp(pOneChar, "§Ö") == 0 ||
						strcmp(pOneChar, "§×") == 0 || strcmp(pOneChar, "§Ø") == 0 || strcmp(pOneChar, "§¡") == 0 || strcmp(pOneChar, "§¢") == 0 || strcmp(pOneChar, "§£") == 0 || strcmp(pOneChar, "¡É") == 0 ||
						strcmp(pOneChar, "¡Æ") == 0 || strcmp(pOneChar, "¡¾") == 0 || strcmp(pOneChar, "¢ª") == 0)
					{
						pTemp[nTmp++] = pOri[n++];
						pTemp[nTmp++] = pOri[n++];
					}
					else
					{
						n = n + 2;
						nReturn = 1;
					}
				}
				else if (nChar == TWIN_CHAR_WORD)
				{
					n = n + 2;
					nReturn = 1;
				}
				else
				{
					pTemp[nTmp++] = pOri[n++];
					pTemp[nTmp++] = pOri[n++];
				}
			}
			else
			{
				if (GetCharCode(pOneChar) == SPECIAL_CHAR_WORD)
				{
					n = n + 1;
					nReturn = 1;
				}
				else
					pTemp[nTmp++] = pOri[n++];
			}
		}
	}
	if (nReturn != -1)
	{
		//2017-11-14 Temp¿¡ °ªÀÌ Á¸Àç ÇÏÁö ¾ÊÀ» °æ¿ì
		if(pTemp != "")
		{
			delete[] m_pNode->pPreToken->strOriginalSource;
			m_pNode->pPreToken->strOriginalSource = new char[strlen(pTemp) + 1];
			memset(m_pNode->pPreToken->strOriginalSource, 0x00, strlen(pTemp) + 1);
			strcpy(m_pNode->pPreToken->strOriginalSource, pTemp);
		}
	}

	return nReturn;
}

// Æ¯¼ö±âÈ£ (ÇÑÀÚ->ÇÑ±Ûº¯È¯)
int CPreProcessor::Hanja2Hangul(PRE_NODE* m_pNode)
{
	int nReturn = -1;
	int n, nLen = 0;
	char pOneChar[3];
	char* pOri = NULL;
	int nTmp = 0;
	char pTemp[1204];
	int nChar = -1;
	unsigned int hangul;

	memset(pTemp, 0x00, 1024);

	if (m_pNode != NULL && m_pNode->pPreToken != NULL && m_pNode->pPreToken->strOriginalSource != NULL)
	{
		pOri = m_pNode->pPreToken->strOriginalSource;
		nLen = strlen(pOri);
		for (n = 0; n<nLen;)
		{
			memset(pOneChar, 0x00, 3);
			pOneChar[0] = pOri[n];
			if (pOneChar[0] & 0x80) // 2 Byte Char?
			{
				pOneChar[1] = pOri[n + 1];
				nChar = -1;
				nChar = GetCharCode(pOneChar);
				if (nChar == CHINESE_CHAR_WORD)
				{
					hangul = hanja_conv(pOneChar[0], pOneChar[1]);
					pTemp[nTmp++] = (hangul >> 8) & 0xff;
					pTemp[nTmp++] = hangul & 0xff;
					n = n + 2;
					nReturn = 1;
				}
				else
				{
					pTemp[nTmp++] = pOri[n++];
					pTemp[nTmp++] = pOri[n++];
				}
			}
			else
				pTemp[nTmp++] = pOri[n++];
		}
	}
	if (nReturn != -1)
	{
		//2017-11-14 Temp¿¡ °ªÀÌ Á¸ÀçÇÏÁö ¾ÊÀ» °æ¿ì
		if(pTemp != "")
		{
			delete[] m_pNode->pPreToken->strOriginalSource;
			m_pNode->pPreToken->strOriginalSource = new char[strlen(pTemp) + 1];
			memset(m_pNode->pPreToken->strOriginalSource, 0x00, strlen(pTemp) + 1);
			strcpy(m_pNode->pPreToken->strOriginalSource, pTemp);
		}
	}

	return nReturn;
}

// ´ÙÀ½ ¹®ÀÚ CharÀÌµ¿
bool CPreProcessor::NextCharPos(char* pChar, int& nPos)
{
	bool bReturn = false;
	int nLen = strlen(pChar);
	while (pChar[nPos] == ' ' || pChar[nPos] == '\r' || pChar[nPos] == '\n' || pChar[nPos] == '\t')
	{
		if (pChar[nPos] == '\r' || pChar[nPos] == '\n')
			bReturn = true;
		nPos++;

		if (nPos>nLen)
			break;
	}
	return bReturn;
}

int CPreProcessor::ParentNodeTotal(CNAPreLinkedList* pPreLinkedList, PRE_NODE* m_pNode)
{
	int nReturn = -1;
	int nCount = 0;
	//'<' Ã³¸®
	if (m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_1)
	{
		nReturn = SetParentNode1(pPreLinkedList, m_pNode, SYMBOL_CHAR_1, SYMBOL_CHAR_5);
		if (nReturn == -1)
		{
			NodeOneCharRemove(m_pNode, "<");
		}
	}
	//'(' Ã³¸®
	else if (m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_2)
	{
		nReturn = SetParentNode1(pPreLinkedList, m_pNode, SYMBOL_CHAR_2, SYMBOL_CHAR_6);
		if (nReturn == -1)
		{
			NodeOneCharRemove(m_pNode, "(");
		}
	}
	//'[' Ã³¸®
	else if (m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_3)
	{
		nReturn = SetParentNode1(pPreLinkedList, m_pNode, SYMBOL_CHAR_3, SYMBOL_CHAR_7);
		if (nReturn == -1)
		{
			NodeOneCharRemove(m_pNode, "[");
		}
	}
	//'{' Ã³¸®
	else if (m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_4)
	{
		nReturn = SetParentNode1(pPreLinkedList, m_pNode, SYMBOL_CHAR_4, SYMBOL_CHAR_8);
		if (nReturn == -1)
		{
			NodeOneCharRemove(m_pNode, "{");
		}
	}
	// '"' Ã³¸®
	else if ((nCount = CharFindSymbol(m_pNode, "\"")) != -1)
	{
		if (nCount > 1)
		{
			NodeOneCharRemove(m_pNode, "\"");
		}
		else if (SetParentNode2(pPreLinkedList, m_pNode) == false)
		{
			NodeOneCharRemove(m_pNode, "\"");
		}
		else
			nReturn = 1;
	}
	else if (m_pNode->pPreToken->nFirstParent == SYMBOL_CHAR_6)
	{
		NodeOneCharRemove(m_pNode, ")");
	}
	// "'" Ã³¸®
	else
	{
		nReturn = CharFindSymbol(m_pNode, "'");
		if (nReturn != -1)
		{
			NodeOneCharRemove(m_pNode, "'");
			nReturn = 1;
		}
	}

	return nReturn;
}

// '(', '{', '[', '<' Ã³¸®
int CPreProcessor::SetParentNode1(CNAPreLinkedList* pPreLinkedList, PRE_NODE* m_pNode, int nCase1, int nCase2)
{
	int nReturn = -1;
	int nParent = 0;
	int nLen, nParentPos = -1, n = -1;
	PRE_NODE* pFirstNode = m_pNode;
	PRE_NODE* pCommaTmpNode = NULL;
	char pDelChar1[2];
	char pDelChar2[2];

	memset(pDelChar1, 0x00, 2);
	memset(pDelChar2, 0x00, 2);

	if (nCase2 == SYMBOL_CHAR_5)
	{
		pDelChar1[0] = '<'; pDelChar2[0] = '>';
	}
	else if (nCase2 == SYMBOL_CHAR_6)
	{
		pDelChar1[0] = '('; pDelChar2[0] = ')';
	}
	else if (nCase2 == SYMBOL_CHAR_7)
	{
		pDelChar1[0] = '{'; pDelChar2[0] = '}';
	}
	else if (nCase2 == SYMBOL_CHAR_8)
	{
		pDelChar1[0] = '['; pDelChar2[0] = ']';
	}
	else
		return false;

	// ¿©´Â °ýÈ£¿Í ´Ý´Â °ýÈ£°¡ °°ÀÌ ÀÖÀ» ¶§ ¿¹) ÀÌ¼º±Ô(³»Ãß·²), (ÀÌ¼º±Ô)³»Ãß·²
	if (m_pNode->pPreToken->nFirstParent == m_pNode->pPreToken->nLastParent - 4)
	{
		nLen = strlen(m_pNode->pPreToken->strOriginalSource);
		// (³»Ãß·²)ÀÎ °æ¿ì
		if (m_pNode->pPreToken->strOriginalSource[nLen - 1] == pDelChar2[0] &&
			m_pNode->pPreToken->strOriginalSource[0] == pDelChar1[0])
		{
			NodeOneCharRemove(m_pNode, pDelChar1);
			NodeOneCharRemove(m_pNode, pDelChar2);
			return 2;
		}
		// ')' µÚ¿¡ ÀÖ´Â°¡?
		else if (m_pNode->pPreToken->strOriginalSource[nLen - 1] == pDelChar2[0])
		{
			n = 0;
			while (m_pNode->pPreToken->strOriginalSource[n] != 0x00)
			{
				if (m_pNode->pPreToken->strOriginalSource[n] == pDelChar1[0])
				{
					nParentPos = n;
					break;
				}
				n++;
			}
			if (nParentPos > 0)
			{
				//------m_pPreLinkedList->PreNodeDivide(m_pNode, nParentPos, 1);
				pPreLinkedList->PreNodeDivide(m_pNode, nParentPos, 1);
				NodeOneCharRemove(m_pNode->pNext, pDelChar1);
				NodeOneCharRemove(m_pNode->pNext, pDelChar2);
			}
			return 2;
		}
		else if (m_pNode->pPreToken->strOriginalSource[0] == pDelChar1[0])
		{
			n = 0;
			while (m_pNode->pPreToken->strOriginalSource[n] != 0x00)
			{
				if (m_pNode->pPreToken->strOriginalSource[n] == pDelChar2[0])
				{
					nParentPos = n;
					break;
				}
				n++;
			}
			if (nParentPos > 0)
			{
				//------m_pPreLinkedList->PreNodeDivide(m_pNode, nParentPos, 1);
				pPreLinkedList->PreNodeDivide(m_pNode, nParentPos, 1);
				NodeOneCharRemove(m_pNode, pDelChar1);
				NodeOneCharRemove(m_pNode, pDelChar2);
			}
			return 2;
		}
	}

	// ¿©´Â °ýÈ£·çÀÌ°í ±× À§°¡°¡ ÅäÅ«ÀÇ Ã³À½ÀÌ ¾Æ´Ñ°¡?
	if (m_pNode->pPreToken->strOriginalSource[0] != pDelChar1[0])
	{
		n = 0;
		// ')', '}', ']'. '>' Position À§Ä¡ ÀúÀå
		while (m_pNode->pPreToken->strOriginalSource[n] != 0x00)
		{
			if (m_pNode->pPreToken->strOriginalSource[n] == pDelChar1[0])
			{
				nParentPos = n;
				break;
			}
			n++;
		}
	}

	// ')', '}', ']'. '>' ³ª¿Ã¶§±îÁö ÁøÇà
	while (m_pNode != pPreLinkedList->m_pTailNode)
	{
		if (m_pNode->pPreToken->nFirstParent == nCase1)
		{
			nParent++;
		}

		if (m_pNode->pPreToken->nLastParent == nCase2)
		{
			nParent--;
			if (nParent == 0) //°ýÈ£ÀÇ ½ÃÀÛ°ú ³¡
			{
				if (nParentPos > 0 && (int)strlen(pFirstNode->pPreToken->strOriginalSource) > nParentPos + 1)
				{
					// ')', '}', ']'. '>' Position À§Ä¡¿¡¼­ PreNode Ãß°¡
					//------m_pPreLinkedList->PreNodeDivide(pFirstNode, nParentPos, 1);
					pPreLinkedList->PreNodeDivide(pFirstNode, nParentPos, 1);

					if (pFirstNode == m_pNode)
						m_pNode = m_pNode->pNext;

					nReturn = 2;
				}
				else
					NodeOneCharRemove(pFirstNode, pDelChar1);

				// pFirstNode¿¡ [ns] ÀÚÁú Setting
				pFirstNode->pPreToken->pFeature[SYMBOL_NS] = '1';

				// m_pNode¿¡ [ne] ÀÚÁú Setting
				m_pNode->pPreToken->pFeature[SYMBOL_NE] = '1';
				NodeOneCharRemove(m_pNode, pDelChar2);
				nLen = strlen(m_pNode->pPreToken->strOriginalSource);
				if (m_pNode->pPreToken->strOriginalSource[nLen - 1] == '.')
					m_pNode->pPreToken->strOriginalSource[nLen - 1] = 0;

				if (pCommaTmpNode != NULL)
				{
					pCommaTmpNode->pPreToken->nEndCheck = PRENODE_CHAR_4; //',' ÀÎÁõ
					pCommaTmpNode->pPreToken->pFeature[SYMBOL_COMMA] = '1';
					pCommaTmpNode->pPreToken->pFeature[SYMBOL_CLAUSE] = '1';
					pCommaTmpNode = m_pNode;
				}

				if (nReturn == -1)
					nReturn = 1;
				break;
			}
		}

		// ',' Ã³¸®ºÎºÐ
		if (m_pNode->pPreToken->nEndCheck == PRENODE_CHAR_3)
		{
			if (pCommaTmpNode != NULL)
			{
				pCommaTmpNode->pPreToken->nEndCheck = PRENODE_CHAR_4; //',' ÀÎÁõ
				pCommaTmpNode->pPreToken->pFeature[SYMBOL_COMMA] = '1';
				pCommaTmpNode->pPreToken->pFeature[SYMBOL_CLAUSE] = '1';
				pCommaTmpNode = m_pNode;
			}
			pCommaTmpNode = m_pNode;
		}

		m_pNode = m_pNode->pNext;
	}	// end while

	return nReturn;
}

// '"' Ã³¸®
bool CPreProcessor::SetParentNode2(CNAPreLinkedList* pPreLinkedList, PRE_NODE* m_pNode)
{
	bool bReturn = false;
	int nParent = 1;
	PRE_NODE* pCommaTmpNode = NULL;
	PRE_NODE* pFirstNode = m_pNode;
	char* pFeature = NULL;

	// '"' ³ª¿Ã¶§±îÁö ÁøÇà
	//m_pNode = m_pNode->pNext;
	// ¿©´Â µû¿ÈÇ¥ ÀÚÁú ºÎ¿©
	if (pFirstNode != NULL && pFirstNode->pPreToken != NULL)
		pFeature = pFirstNode->pPreToken->pFeature;

	while (m_pNode != pPreLinkedList->m_pTailNode)
	{
		if (m_pNode != pFirstNode && CharFindSymbol(m_pNode, "\"") != -1)
		{
			if (m_pNode->pPreToken->strOriginalSource[0] != '\"')
			{
				nParent--;
				if (nParent == 0)
				{
					NodeOneCharRemove(pFirstNode, "\"");
					NodeOneCharRemove(m_pNode, "\"");
					NodeOneCharRemove(m_pNode, ".");
					//´Ý´Â µû¿ÈÇ¥ ÀÚÁú ºÎ¿©
					if (m_pNode != NULL && m_pNode->pPreToken != NULL)
					{
						//´Ý´Â µû¿ÈÇ¥ ÀÚÁú ºÎ¿©
						if (strlen(pFirstNode->pPreToken->strOriginalSource) == 0 &&
							pFirstNode->pNext != NULL && pFirstNode->pNext->pPreToken != NULL)
						{
							pFirstNode->pNext->pPreToken->pFeature[SYMBOL_TS] = '1';
							pFirstNode->pNext->pPreToken->nOffset = pFirstNode->pPreToken->nOffset;
						}
						else
							pFeature[SYMBOL_TS] = '1';
						m_pNode->pPreToken->pFeature[SYMBOL_TE] = '1';
					}

					bReturn = true;

					if (pCommaTmpNode != NULL)
					{
						pCommaTmpNode->pPreToken->nEndCheck = PRENODE_CHAR_4; //',' ÀÎÁõ
						pCommaTmpNode->pPreToken->pFeature[SYMBOL_COMMA] = '1';
						pCommaTmpNode->pPreToken->pFeature[SYMBOL_CLAUSE] = '1';
						pCommaTmpNode = m_pNode;
					}
					break;
				}
				else
					NodeOneCharRemove(m_pNode, "\"");
			}
			else
			{
				nParent++;
				NodeOneCharRemove(m_pNode, "\"");
			}
		}

		// ',' Ã³¸®ºÎºÐ
		if (m_pNode->pPreToken->nEndCheck == PRENODE_CHAR_3)
		{
			if (pCommaTmpNode != NULL)
			{
				pCommaTmpNode->pPreToken->nEndCheck = PRENODE_CHAR_4; //',' ÀÎÁõ
				pCommaTmpNode->pPreToken->pFeature[SYMBOL_COMMA] = '1';
				pCommaTmpNode->pPreToken->pFeature[SYMBOL_CLAUSE] = '1';
				pCommaTmpNode = m_pNode;
			}
			pCommaTmpNode = m_pNode;
		}

		m_pNode = m_pNode->pNext;
	}

	return bReturn;
}

bool CPreProcessor::NodeStrCmp(PRE_NODE* m_pNode, char* pCmp, int nCase)
{
	int nLen1 = 0;
	int nLen2 = 0;
	int i, j;

	if (m_pNode != NULL && m_pNode->pPreToken != NULL &&
		m_pNode->pPreToken->strOriginalSource != NULL && pCmp != NULL)
	{
		if (nCase == 0)
		{
			nLen1 = strlen(pCmp);
			nLen2 = strlen(m_pNode->pPreToken->strOriginalSource);
			for (i = 0; i<nLen2; i++)
			{
				for (j = 0; j<nLen1; j++)
				{
					if (m_pNode->pPreToken->strOriginalSource[i] == pCmp[j])
						return true;
				}
			}
		}
		// Ã¹±ÛÀÚ°¡ ºñ±³µÇ´Â ¹®ÀÚÀÎÁö..
		else
		{
			nLen1 = strlen(pCmp);
			for (j = 0; j<nLen1; j++)
			{
				if (m_pNode->pPreToken->strOriginalSource[0] == pCmp[j])
					return true;
			}
		}
	}
	return false;
}

void CPreProcessor::NodeOneCharRemove(PRE_NODE* m_pNode, char* pCmp)
{
	int nLen = 0;
	int i;
	char pTmp[1024];
	int nTmp = 0;

	memset(pTmp, 0x00, 1024);

	if (m_pNode != NULL && m_pNode->pPreToken != NULL &&
		m_pNode->pPreToken->strOriginalSource != NULL && pCmp != NULL)
	{
		nLen = strlen(m_pNode->pPreToken->strOriginalSource);
		for (i = 0; i<nLen; i++)
		{
			if (m_pNode->pPreToken->strOriginalSource[i] != pCmp[0])
				pTmp[nTmp++] = m_pNode->pPreToken->strOriginalSource[i];
		}

		if (nTmp < nLen)
		{
			delete[] m_pNode->pPreToken->strOriginalSource;
			m_pNode->pPreToken->strOriginalSource = new char[strlen(pTmp) + 1];
			memset(m_pNode->pPreToken->strOriginalSource, 0x00, strlen(pTmp) + 1);
			strcpy(m_pNode->pPreToken->strOriginalSource, pTmp);
		}
	}
}

// 2 Byte Char »èÁ¦
void CPreProcessor::NodeTwoCharRemove(PRE_NODE* m_pNode, char* pCmp) //pCmp ¹®ÀÚ¸¦ Á¦°Å
{
	int i, nLen, nPos;
	char pTmp[1024];
	int nTmp = 0;
	char* pStr = NULL;

	memset(pTmp, 0x00, 1024);

	if (m_pNode != NULL && m_pNode->pPreToken != NULL &&
		m_pNode->pPreToken->strOriginalSource != NULL && pCmp != NULL)
	{
		nLen = strlen(m_pNode->pPreToken->strOriginalSource);
		pStr = strstr(m_pNode->pPreToken->strOriginalSource, pCmp);
		if (pStr != NULL)
		{
			nPos = pStr - m_pNode->pPreToken->strOriginalSource;
			for (i = 0; i<nLen; i++)
			{
				if (i == nPos)
					i++;
				else
					pTmp[nTmp++] = m_pNode->pPreToken->strOriginalSource[i];
			}
			delete[] m_pNode->pPreToken->strOriginalSource;
			m_pNode->pPreToken->strOriginalSource = new char[strlen(pTmp) + 1];
			memset(m_pNode->pPreToken->strOriginalSource, 0x00, strlen(pTmp) + 1);
			strcpy(m_pNode->pPreToken->strOriginalSource, pTmp);
		}
	}
}

//'/', '¡¤' Ã³¸®
int CPreProcessor::IsSlachDot(char *pString, int nPos, int isAscii)
{
	int nReturn = -1;
	char pOneChar[3];
	int nStart = 0;
	int nEnd = 0;
	int nLen = strlen(pString);

	memset(pOneChar, 0x00, 3);

	switch (isAscii)
	{
		// '/' °æ¿ì(1 byte)
	case TRUE_ASCII:
		// ¾ÕºÎºÐ
		if (nPos - 1 >= 0)
		{
			pOneChar[0] = pString[nPos - 1];
			if (pOneChar[0] >= '0' && pOneChar[0] <= '9')
			{
				nStart = 1;
			}
			else if (nPos - 2>0)
			{
				memset(pOneChar, 0x00, 3);
				pOneChar[0] = pString[nPos - 2];
				pOneChar[1] = pString[nPos - 1];
				if (GetCharCode(pOneChar) == HANGUL_CHAR_WORD)
				{
					nStart = 2;
				}
			}
		}

		// µÚºÎºÐ
		if (nPos + 1 < nLen)
		{
			pOneChar[0] = pString[nPos + 1];
			if (pOneChar[0] >= '0' && pOneChar[0] <= '9')
			{
				nEnd = 1;
			}
			else if (nPos + 2 < nLen)
			{
				pOneChar[1] = pString[nPos + 2];
				if (GetCharCode(pOneChar) == HANGUL_CHAR_WORD)
				{
					nEnd = 2;
				}
			}
		}
		break;

		// '¡¤' (2 byte)
	case FALSE_ASCII:
		// ¾ÕºÎºÐ
		// ¾ÕºÎºÐ
		if (nPos - 1 >= 0)
		{
			pOneChar[0] = pString[nPos - 1];
			if (pOneChar[0] >= '0' && pOneChar[0] <= '9')
			{
				nStart = 1;
			}
			else if (nPos - 2>0)
			{
				memset(pOneChar, 0x00, 3);
				pOneChar[0] = pString[nPos - 2];
				pOneChar[1] = pString[nPos - 1];
				if (GetCharCode(pOneChar) == HANGUL_CHAR_WORD)
				{
					nStart = 2;
				}
			}
		}

		// µÚºÎºÐ
		if (nPos + 1 < nLen)
		{
			pOneChar[0] = pString[nPos + 2];
			if (pOneChar[0] >= '0' && pOneChar[0] <= '9')
			{
				nEnd = 1;
			}
			else if (nPos + 2 < nLen)
			{
				pOneChar[1] = pString[nPos + 3];
				if (GetCharCode(pOneChar) == HANGUL_CHAR_WORD)
				{
					nEnd = 2;
				}
			}
		}
		break;
	}

	if (nStart == 1 && nEnd == 1)
		nReturn = 1;		//¾ÕµÚ ¼ýÀÚ ÀÎ°æ¿ì
	else if (nStart == 1 && nEnd == 2)
		nReturn = 2;		//¾Õ(¼ýÀÚ),µÞ(ÇÑ±Û)
	else if (nStart == 2 && nEnd == 1)
		nReturn = 3;		//¾Õ(ÇÑ±Û),µÚ(¼ýÀÚ)
	else if (nStart == 2 && nEnd == 2)
		nReturn = 4;		//¾ÕµÚ ÇÑ±Û

	return nReturn;
}
//»ê¼ú¿¬»êÃ³¸® 
bool CPreProcessor::IsOperation(char *pString, int nPos, int isAscii)
{
	bool isbValue = false;
	int nTotalCount = 0;
	char pOneChar[3];

	nTotalCount = strlen(pString);
	memset(pOneChar, 0x00, 3);

	switch (isAscii)
	{
	case TRUE_ASCII:
		if (nPos - 1 < 0 || nPos == nTotalCount - 1)
			isbValue = false;
		else
		{
			if (nPos + 1 <= nTotalCount)
			{
				if ((pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' &&
					pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9') ||

					(pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' &&
						pString[nPos + 1] >= 'a' && pString[nPos + 1] <= 'z') ||

						(pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' &&
							pString[nPos + 1] >= 'A' && pString[nPos + 1] <= 'Z') ||

							(pString[nPos - 1] >= 'a' && pString[nPos - 1] <= 'z' &&
								pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9') ||

								(pString[nPos - 1] >= 'A' && pString[nPos - 1] <= 'Z' &&
									pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9') ||

									(pString[nPos - 1] >= 'A' && pString[nPos - 1] <= 'Z' &&
										pString[nPos + 1] >= 'a' && pString[nPos + 1] <= 'z') ||

										(pString[nPos - 1] >= 'a' && pString[nPos - 1] <= 'z' &&
											pString[nPos + 1] >= 'A' && pString[nPos + 1] <= 'Z') ||

											(pString[nPos - 1] >= 'a' && pString[nPos - 1] <= 'z' &&
												pString[nPos + 1] >= 'a' && pString[nPos + 1] <= 'z') ||

												(pString[nPos - 1] >= 'A' && pString[nPos - 1] <= 'Z' &&
													pString[nPos + 1] >= 'A' && pString[nPos + 1] <= 'Z'))

					isbValue = true;
				else
					isbValue = false;
			}
			else
				isbValue = false;
		}
		break;
	case FALSE_ASCII:
		if (nPos - 1 >= 0 || nPos + 1 == nTotalCount - 1)
			isbValue = false;
		else
		{
			if (nPos + 2 <= nTotalCount)
			{
				if (pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' &&
					pString[nPos + 2] >= '0' && pString[nPos + 2] <= '9')
					isbValue = true;
				else
					isbValue = false;
			}
			else
				isbValue = false;
		}
		break;
	}
	return isbValue;
}

//ÅëÈ­´ÜÀ§Ã³¸®
bool CPreProcessor::IsCurrency(char *pString, int nPos, int isAscii)
{
	bool isbValue = false;
	int nTotalCount = 0;
	nTotalCount = strlen(pString);

	switch (isAscii)
	{
	case TRUE_ASCII:
		if (nPos - 1 < 0 || nPos == nTotalCount - 1)
		{
			if (nPos >= 0)
			{
				if (nPos + 1 <= nTotalCount)
				{
					if (pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9')
						isbValue = true;
					else
						isbValue = false;
				}
				else
					isbValue = false;
			}
			if (nPos == nTotalCount - 1)
			{
				if (nPos - 1 >= 0)
				{
					if (pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9')
						isbValue = true;
					else
						isbValue = false;
				}
				else
					isbValue = false;
			}
		}
		else
		{
			if (nPos + 1 <= nTotalCount)
			{
				if (pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' ||
					pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9')
					isbValue = true;
				else
					isbValue = false;
			}
			else
				isbValue = false;
		}
		break;
	case FALSE_ASCII:
		if (nPos - 1 <= 0 || nPos + 1 == nTotalCount - 1)
		{
			if (nPos - 1 <= 0)
			{
				if (nPos + 2 <= nTotalCount)
				{
					if (pString[nPos + 2] >= '0' && pString[nPos + 2] <= '9')
						isbValue = true;
					else
						isbValue = false;
				}
				else
					isbValue = false;
			}
			if (nPos + 1 == nTotalCount - 1)
			{
				if (nPos - 1 >= 0)
				{
					if (pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9')
						isbValue = true;
					else
						isbValue = false;
				}
				else
					isbValue = false;
			}
		}
		else
		{
			if (nPos + 2 <= nTotalCount)
			{
				if (pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' &&
					pString[nPos + 2] >= '0' && pString[nPos + 2] <= '9')
					isbValue = true;
				else
					isbValue = false;
			}
			else
				isbValue = false;
		}
		break;
	}
	return isbValue;
}

//ÀÎÅÍ³Ý ±âÈ£ @
bool CPreProcessor::IsInternetChar(char *pString, int nPos, int isAscii)
{
	bool isbValue = false;
	int nTotalCount = 0;
	int nPrevPos = 0;
	int nNextPos = 0;
	bool bPrevAllCharEng = false;
	bool bNextAllCharEng = false;
	nTotalCount = strlen(pString);

	switch (isAscii)
	{
	case TRUE_ASCII:
		if (nPos - 1 < 0 || nPos == nTotalCount - 1)
			isbValue = false;
		else
		{
			if (nPos + 1 <= nTotalCount)
			{
				nPrevPos = nPos - 1;
				while (nPrevPos > 0)
				{
					if (pString[nPrevPos] & 0x80)
					{
						bPrevAllCharEng = false;
						break;
					}
					else
					{
						if (!bPrevAllCharEng)
							bPrevAllCharEng = true;
					}
					nPrevPos -= 1;
				}
				nNextPos = nPos + 1;
				while (nNextPos < nTotalCount)
				{
					if (pString[nNextPos] & 0x80)
					{
						bNextAllCharEng = false;
						break;
					}
					else
					{
						if (!bNextAllCharEng)
							bNextAllCharEng = true;
					}
					nNextPos += 1;
				}
				if (bPrevAllCharEng == true && bNextAllCharEng == true)
					isbValue = true;
				else
					isbValue = false;
			}
			else
				isbValue = false;
		}
		break;
	case FALSE_ASCII:
		break;
	}
	return isbValue;
}

//.¿¡ ´ëÇÑ Ã³¸® 
bool CPreProcessor::IsDot(char *pString, int nPos, int isAscii)
{
	bool isbValue = false;
	int nTotalCount = 0;
	char pOneChar[3];
	nTotalCount = strlen(pString);

	switch (isAscii)
	{
	case TRUE_ASCII:
		if (nPos - 1 < 0)
			isbValue = false;
		else if (nPos == nTotalCount - 1)
		{
			if (pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' ||
				pString[nPos - 1] >= 'a' && pString[nPos - 1] <= 'z' ||
				pString[nPos - 1] >= 'A' && pString[nPos - 1] <= 'Z')
				isbValue = true;
		}
		else
		{
			if (nPos + 1 <= nTotalCount)
			{
				if ((pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' && pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9') ||
					(pString[nPos - 1] >= 'a' && pString[nPos - 1] <= 'z' && pString[nPos + 1] >= 'a' && pString[nPos + 1] <= 'z') ||
					(pString[nPos - 1] >= 'A' && pString[nPos - 1] <= 'Z' && pString[nPos + 1] >= 'A' && pString[nPos + 1] <= 'Z') ||
					(pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' && pString[nPos + 1] >= 'a' && pString[nPos + 1] <= 'z') ||
					(pString[nPos - 1] >= '0' && pString[nPos - 1] <= '9' && pString[nPos + 1] >= 'A' && pString[nPos + 1] <= 'Z') ||
					(pString[nPos - 1] >= 'a' && pString[nPos - 1] <= 'z' && pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9') ||
					(pString[nPos - 1] >= 'A' && pString[nPos - 1] <= 'Z' && pString[nPos + 1] >= '0' && pString[nPos + 1] <= '9'))
					isbValue = true;
				else
					isbValue = false;
			}
			else
				isbValue = false;
		}
		break;
	case FALSE_ASCII:
		break;
	case 3:
		memset(pOneChar, 0x00, 3);
		pOneChar[0] = pString[nPos - 2];
		pOneChar[1] = pString[nPos - 1];

		if (GetCharCode(pOneChar) == HANGUL_CHAR_WORD)
		{
			if (nTotalCount > nPos + 2)
			{
				memset(pOneChar, 0x00, 3);
				pOneChar[0] = pString[nPos + 1];
				pOneChar[1] = pString[nPos + 2];
				if (GetCharCode(pOneChar) == HANGUL_CHAR_WORD)
				{
					isbValue = true;
				}
			}
		}
		break;
	}
	return isbValue;
}

// Hanja API
int CPreProcessor::hanja_bsearch(unsigned int item)
{
	int mid;
	int min = 0, max = N_HANJA;

	while (min <= max) {
		mid = (max + min) / 2;
		if (kschanja[mid].hanja == item)
			return mid;
		else if (kschanja[mid].hanja > item)
			max = mid - 1;
		else if (kschanja[mid].hanja < item)
			min = mid + 1;

	}
	return -1;
}

unsigned int CPreProcessor::hanja_conv(char hbyte, char lbyte)
{
	int i;
	unsigned int hanja = ((hbyte << 8) & 0xff00) | (lbyte & 0xff);

	i = hanja_bsearch(hanja);
	return ((i < 0) ? hanja : kschanja[i].hangul);
}

int CPreProcessor::IsKindCode(int high, int low)
{
	if ((high >= 0xB0 && high <= 0xC8) &&
		(low >= 0xA1 && low <= 0xFE)) // hangul code
	{
		return HANGUL_CHAR_WORD;
	}
	else if ((high == 0xAA) &&
		(low >= 0xA1 && low <= 0xF3))// hiragana
	{
		return HIRAGANA_CHAR_WORD;
	}
	else if ((high == 0xAB) &&
		(low >= 0xA1 && low <= 0xF6))// katakana
	{
		return KATAGANA_CHAR_WORD;
	}
	else if ((high >= 0xCA && high <= 0xCF) && (low >= 0xA1 && low <= 0xFE) //hanja area 1
		|| (high >= 0xD0 && high <= 0xDF) && (low >= 0xA1 && low <= 0xFE) //hanja area 2
		|| (high >= 0xE0 && high <= 0xEF) && (low >= 0xA1 && low <= 0xFE) //hanja area 3 
		|| (high >= 0xF0 && high <= 0xFD) && (low >= 0xA1 && low <= 0xFE))//hanja area 4 
	{
		return CHINESE_CHAR_WORD;
	}
	else if (high >= 'A' && high <= 'Z' || high >= 'a' && high <= 'z')//english
	{
		return ENGLISH_CHAR_WORD;
	}
	else if (high == 0xA1 && (low >= 0xa2 && low <= 0xa4)
		|| high == 0x63 || high == 0x21)//single sentence symbol(¡£, ¡¢,¡¤,?,!)
	{
		return SINGLE_CHAR_WORD;
	}
	else if ((high == 0xa1 && low <= 0xbd) || high == 0x28
		|| high == 0x29 || high == 0x60 || high == 0x62 || high == 0x91 || high == 0x93)//twin sentence symbol(¡º,¡»,¡¸,¡¹,¡¼,¡½,(,),<,>,[,]/
	{
		return TWIN_CHAR_WORD;
	}
	else if (high >= '0' && high <= '9'
		|| high == 0xa1 && low == 0xcd
		|| high == 0xa3 && low == 0xa4
		|| high == 0xa3 && low == 0xdc)//number ..£Ü£¤¡Í
	{
		return NUMBER_CHAR_WORD;
	}
	else //±×¿Ü Æ¯¼ö¹®ÀÚ·Î ¸ðµÎ Ã³¸®
		return SPECIAL_CHAR_WORD;
}

int CPreProcessor::GetHighLow(int nKindCode, int *high, int *low)
{
	int ret = 0;
	*high = (nKindCode & 0xFF00) >> 8;
	*low = (nKindCode & 0x00FF);
	ret = IsKindCode(*high, *low);
	return ret;
}

int CPreProcessor::GetSylCode(char *pKindCode)
{
	int syl = 0;
	char *p = pKindCode;
	syl = (*p << 8) & 0x0000FF00;
	syl |= *(p + 1) & 0x000000FF;
	return syl;
}

int CPreProcessor::GetCharCode(char *pKindCode)
{
	int syl = 0;
	char *p = pKindCode;
	syl = (*p << 8) & 0x0000FF00;
	syl |= *(p + 1) & 0x000000FF;
	return GetHighLow(syl);
}

int CPreProcessor::GetHighLow(int nKindCode)
{
	int ret = 0;
	int high, low;
	high = (nKindCode & 0xFF00) >> 8;
	low = (nKindCode & 0x00FF);
	ret = IsKindCode(high, low);
	return ret;
}

double CPreProcessor::GetAnalysisResultTime()
{
	return m_nAnalysisResultTime;
}